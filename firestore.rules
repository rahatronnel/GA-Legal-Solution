
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // -------------------------------------------------------------------------
    // Helper Functions
    // -------------------------------------------------------------------------
    function isAuthenticated() {
      return request.auth != null;
    }

    // Checks if the user has an 'Admin' role claim.
    // This is a placeholder for a more robust role-based system.
    function isAdmin() {
      return isAuthenticated() && get(/databases/$(database)/documents/employees/$(request.auth.uid)).data.role == 'Admin';
    }

    // -------------------------------------------------------------------------
    // Default Security Rule
    // -------------------------------------------------------------------------
    match /{document=**} {
      allow read, write: if isAuthenticated();
    }

    // -------------------------------------------------------------------------
    // Singleton & Public Master Data
    // These collections contain general configuration or master list data.
    // -------------------------------------------------------------------------
    match /settings/{docId}      { allow write: if isAdmin(); }
    
    match /vehicleTypes/{docId}   { allow read: if true; allow write: if isAdmin(); }
    match /vehicleBrands/{docId}  { allow read: if true; allow write: if isAdmin(); }
    match /locations/{docId}      { allow read: if true; allow write: if isAdmin(); }
    match /routes/{docId}         { allow write: if isAdmin(); } // Routes are not public by default
    
    match /tripPurposes/{docId}   { allow read: if true; allow write: if isAdmin(); }
    match /expenseTypes/{docId}   { allow read: if true; allow write: if isAdmin(); }
    match /maintenanceTypes/{docId}{ allow read: if true; allow write: if isAdmin(); }
    match /maintenanceExpenseTypes/{docId} { allow read: if true; allow write
: if isAdmin(); }
    match /parts/{docId}          { allow read: if true; allow write: if isAdmin(); }
    match /serviceCenters/{docId} { allow read: if true; allow write: if isAdmin(); }
    match /accidentTypes/{docId}  { allow read: if true; allow write: if isAdmin(); }
    match /severityLevels/{docId} { allow read: if true; allow write: if isAdmin(); }
    match /faultStatuses/{docId}  { allow read: if true; allow write: if isAdmin(); }
    
    match /vendorCategories/{docId} { allow read: if true; allow write: if isAdmin(); }
    match /vendorNatureOfBusiness/{docId} { allow read: if true; allow write: if isAdmin(); }
    
    match /billTypes/{docId}      { allow read: if true; allow write: if isAdmin(); }
    match /billCategories/{docId} { allow read: if true; allow write: if isAdmin(); }
    match /billItemCategories/{docId} { allow read: if true; allow write: if isAdmin(); }
    
    match /billItemMasters/{docId} { allow write: if isAdmin(); }
    match /approvalRules/{docId}  { allow write: if isAdmin(); }
    match /sections/{docId}       { allow write: if isAdmin(); }
    match /designations/{docId}   { allow write: if isAdmin(); }

    // -------------------------------------------------------------------------
    // Operational Data
    // -------------------------------------------------------------------------

    // Employees: Only Admins can create, update, or delete employee records.
    // Any authenticated user can read employee data (needed for dropdowns etc.).
    match /employees/{employeeId} {
      allow read: if isAuthenticated();
      allow write: if isAdmin();
    }

    match /vehicles/{docId} {
      allow write: if isAuthenticated();
    }
     match /drivers/{docId} {
      allow write: if isAuthenticated();
    }
     match /trips/{docId} {
      allow read, write: if isAuthenticated();
    }
    match /maintenanceRecords/{docId} {
      allow write: if isAuthenticated();
    }
     match /accidents/{docId} {
      allow write: if isAuthenticated();
    }
    match /vendors/{docId} {
      allow write: if isAuthenticated();
    }
    match /bills/{docId} {
      allow write: if isAuthenticated();
    }
  }
}
